#------------------------------------------------------------------------------
# Makefile
# Для cборки projectTMG
#------------------------------------------------------------------------------
# Компиляторы
CC = g++ -std=c++11
OC = gcc
# Флаги транслятора
CF = -c -MD -Wall
# Префикс компоновщика
PR = -framework
# Для компиляции Objective-C поиска путей до файла
OO = $(PR) Foundation
# Опции линковки с SFML библиотеками/фреймворками
LF = $(PR) sfml-window $(PR) sfml-graphics $(PR) sfml-system $(PR) sfml-audio
# Имя исполняемого файла
OF = game
#------------------------------------------------------------------------------
DIR = Debug
#------------------------------------------------------------------------------
source_dirs := . Engine Modules
#------------------------------------------------------------------------------
search_wildcards := $(addsuffix /*.cpp,$(source_dirs)) 
#------------------------------------------------------------------------------
depend := $(notdir $(patsubst %.cpp,%.o,$(wildcard $(search_wildcards))))
#------------------------------------------------------------------------------
depend += pathfinder.o
#------------------------------------------------------------------------------
depend := $(addprefix $(DIR)/,$(depend))
#------------------------------------------------------------------------------
all: $(DIR)/$(OF)
#------------------------------------------------------------------------------
debug: CF += -DDEBUG
debug: $(DIR)/$(OF)
#------------------------------------------------------------------------------
$(DIR)/$(OF): $(depend)
	$(CC) $(LF) $(OO) $^ -o $@
#------------------------------------------------------------------------------
VPATH := $(source_dirs)
#------------------------------------------------------------------------------
# Все C++ файлы в директориях source_dirs
$(DIR)/%.o: %.cpp
	$(CC) $(CF) $(addprefix -I,$(source_dirs)) $< -o $@
#------------------------------------------------------------------------------
# Все Objective-C файлы в директориях source_dirs
$(DIR)/%.o: %.mm
	$(OC) $(CF) $(addprefix -I,$(source_dirs)) $< -o $@
#------------------------------------------------------------------------------
include $(wildcard *.d) 
#------------------------------------------------------------------------------
# Удалить все object-файлы и исполняемый файл проекта
clean:
	rm -rf $(addprefix $(DIR)/,*.o *.d $(OF))
#------------------------------------------------------------------------------
# Запустить исполняемый файл
run: $(DIR)/$(OF)
	./start ./Frameworks
#------------------------------------------------------------------------------